<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Bodega Santa Clara ‚Äì Vinos y Tapas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{--vino:#722f37;--oro:#c9a227;--madera:#6b4f3a;--fuego:#f5f1e8;--texto:#3a3a3a}
    *{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',sans-serif}
    body{background:var(--fuego);color:var(--texto);padding-bottom:4rem}
    header{background:var(--vino);color:#fff;padding:1.5rem;text-align:center}
    header h1{font-size:2rem;margin-bottom:.5rem}
    header p{font-size:1.1rem;opacity:.9}
    #filtros{display:flex;flex-wrap:wrap;justify-content:center;gap:.5rem;padding:1rem}
    .btn-filtro{background:var(--oro);border:none;padding:.6rem 1rem;border-radius:25px;color:#fff;font-weight:bold;cursor:pointer;transition:.3s}
    .btn-filtro:hover{background:var(--madera)}
    .activo{background:var(--vino)}
    #productos{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:1.5rem;padding:2rem}
    .tarjeta{background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.15);overflow:hidden;display:flex;flex-direction:column}
    .tarjeta img{width:100%;height:200px;object-fit:cover}
    .info{padding:1rem;display:flex;flex-direction:column;flex-grow:1}
    .info h3{margin-bottom:.5rem;color:var(--vino)}
    .precio{font-size:1.3rem;font-weight:bold;color:var(--oro);margin-top:auto}
    .disponible{background:#10b981;color:#fff;padding:.2rem .6rem;border-radius:12px;font-size:.8rem;align-self:flex-start}
    .agotado{background:#ef4444}
    /* Carrito */
    #carritoFlotante{position:fixed;bottom:1rem;right:1rem;background:var(--vino);color:#fff;padding:1rem 1.5rem;border-radius:50px;box-shadow:0 4px 12px rgba(0,0,0,.25);cursor:pointer;display:flex;align-items:center;gap:.5rem;font-weight:bold;z-index:998}
    #modalFondo{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:999;display:none;align-items:center;justify-content:center}
    #modal{background:var(--fuego);border-radius:12px;width:90%;max-width:500px;padding:1.5rem;max-height:80vh;overflow-y:auto}
    #modal h3{margin-bottom:1rem;color:var(--vino)}
    #listaCarrito{margin-bottom:1rem}
    .itemCarrito{display:flex;justify-content:space-between;align-items:center;padding:.5rem 0;border-bottom:1px solid var(--madera)}
    .total{font-size:1.4rem;font-weight:bold;color:var(--oro);margin-top:1rem;text-align:right}
    .botones{display:flex;gap:1rem;margin-top:1.5rem}
    .botones button{flex:1;padding:.75rem;border:none;border-radius:8px;font-weight:bold;cursor:pointer}
    .btn-wsp{background:#25d366;color:#fff}
    .btn-wsp:hover{background:#1ebe5d}
    .btn-cancel{background:#ccc;color:#fff}
    .btn-cancel:hover{background:#bbb}
    /* Admin */
    #loginScreen,#adminScreen{position:fixed;inset:0;background:#fff;z-index:1000;display:flex;align-items:center;justify-content:center}
    .box{width:90%;max-width:400px;background:var(--fuego);border:2px solid var(--vino);border-radius:12px;padding:2rem;text-align:center}
    .box input,.box button{width:100%;margin:.5rem 0;padding:.7rem;border-radius:8px;border:1px solid var(--madera)}
    .box button{background:var(--vino);color:#fff;font-weight:bold;cursor:pointer}
    .box button:hover{background:var(--oro)}
    table{width:100%;border-collapse:collapse;margin-top:1rem}
    th,td{padding:.5rem;border:1px solid var(--madera)}
    th{background:var(--vino);color:#fff}
    img.mini{width:60px;height:60px;object-fit:cover;border-radius:4px}
    .centrado{display:flex;justify-content:center;gap:1rem;margin-top:1rem;flex-wrap:wrap}
    .small{font-size:.8rem;color:var(--madera);margin-top:.3rem}
    footer{text-align:center;padding:1.5rem;background:var(--madera);color:#fff;margin-top:2rem}
  </style>
</head>
<body>
  <header>
    <h1>Bodega Santa Clara</h1>
    <p>Vinos y tapas seleccionadas ¬∑ Villa Clara</p>
  </header>

  <div id="filtros">
    <button class="btn-filtro activo" onclick="filtrar('todos')">Todos</button>
    <button class="btn-filtro" onclick="filtrar('vinos')">Vinos</button>
    <button class="btn-filtro" onclick="filtrar('tapas')">Tapas</button>
    <button class="btn-filtro" onclick="filtrar('accesorios')">Accesorios</button>
  </div>

  <section id="productos"></section>

  <!-- Carrito flotante -->
  <div id="carritoFlotante" onclick="mostrarCarrito()">
    <span id="carritoIcon">üõí</span>
    <span id="carritoCant">0</span>
  </div>

  <!-- Modal resumen pedido -->
  <div id="modalFondo" onclick="cerrarCarrito(event)">
    <div id="modal" onclick="event.stopPropagation()">
      <h3>Tu pedido</h3>
      <div id="listaCarrito"></div>
      <div class="total" id="totalCarrito">0 CUP</div>
      <div class="botones">
        <button class="btn-wsp" onclick="enviarWhatsApp()">Enviar por WhatsApp</button>
        <button class="btn-cancel" onclick="cerrarCarrito()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Login admin -->
  <div id="loginScreen" style="display:none">
    <div class="box">
      <h2>Acceso Administraci√≥n</h2>
      <input id="passInput" type="password" placeholder="Contrase√±a">
      <button onclick="checkPass()">Entrar</button>
      <button onclick="location.href='?'">Volver a la tienda</button>
    </div>
  </div>

  <!-- Panel admin -->
  <div id="adminScreen" style="display:none">
    <div class="box" style="max-width:900px;width:96%">
      <h2>Panel de Administraci√≥n</h2>
      <div class="centrado">
        <button onclick="mostrarForm('add')">A√±adir Producto</button>
        <button onclick="mostrarCambioPass()">Cambiar Contrase√±a</button>
        <button onclick="location.href='?'">Salir Admin</button>
      </div>

      <!-- Form producto -->
      <div id="formDiv" style="display:none;margin-top:1rem;text-align:left">
        <input id="fId" type="hidden">
        <input id="fNombre" placeholder="Nombre" style="width:48%">
        <input id="fPrecio" type="number" placeholder="Precio CUP" style="width:48%;margin-left:4%">
        <select id="fCat" style="width:48%;margin-top:.5rem">
          <option value="vinos">Vinos</option>
          <option value="tapas">Tapas</option>
          <option value="accesorios">Accesorios</option>
        </select>
        <select id="fDisp" style="width:48%;margin-left:4%;margin-top:.5rem">
          <option value="true">Disponible</option>
          <option value="false">Agotado</option>
        </select>

        <!-- Imagen: archivo o url -->
        <input id="fFile" type="file" accept="image/*" style="margin-top:.5rem">
        <div class="small">‚¨ÜÔ∏è O bien sube un archivo desde tu PC</div>
        <input id="fUrl" placeholder="https://tu-imagen.jpg" style="margin-top:.5rem">
        <div class="small">‚¨ÜÔ∏è O pega aqu√≠ el link de tu imagen ya subida a internet</div>

        <img id="fImg" class="mini" style="display:block;margin:.5rem 0">
        <button onclick="guardar()">Guardar</button>
        <button onclick="mostrarForm(null)">Cancelar</button>
      </div>

      <!-- Form cambio pass -->
      <div id="passDiv" style="display:none;margin-top:1rem;text-align:left">
        <input id="passActual" type="password" placeholder="Contrase√±a actual">
        <input id="passNueva1" type="password" placeholder="Nueva contrase√±a">
        <input id="passNueva2" type="password" placeholder="Repite nueva">
        <button onclick="cambiarPass()">Actualizar contrase√±a</button>
        <button onclick="mostrarCambioPass(null)">Cancelar</button>
      </div>

      <!-- Listado productos -->
      <table>
        <thead><tr><th>Imagen</th><th>Nombre</th><th>Precio</th><th>Cat</th><th>Estado</th><th>Acciones</th></tr></thead>
        <tbody id="listaProd"></tbody>
      </table>
    </div>
  </div>

  <script>
    /* ----------  ADMIN  ---------- */
    const PASS_DEFAULT='bodega2024';
    let PASS=localStorage.getItem('bodegaPass')||PASS_DEFAULT;
    let catalogo=JSON.parse(localStorage.getItem('bodegaCatalogo'));
    if(!catalogo || !catalogo.length) catalogo=[
      {id:1,nombre:"Malbec Reserva 2022",precio:2500,categoria:"vinos",disponible:true,img:"https://images.unsplash.com/photo-1585553616435-2dc0a54e271d?auto=format&fit=crop&w=600&q=60"},
      {id:2,nombre:"Queso Manchego Curado",precio:900,categoria:"tapas",disponible:true,img:"https://images.unsplash.com/photo-1486297678162-eb2a19b0a32d?auto=format&fit=crop&w=600&q=60"},
      {id:3,nombre:"Copa Riedel (x2)",precio:1200,categoria:"accesorios",disponible:true,img:"https://images.unsplash.com/photo-1519677100203-a0e668c92439?auto=format&fit=crop&w=600&q=60"}
    ];

    if(location.search.includes('admin')) document.getElementById('loginScreen').style.display='flex';

    function checkPass(){
      if(document.getElementById('passInput').value===PASS){
        document.getElementById('loginScreen').style.display='none';
        document.getElementById('adminScreen').style.display='flex';
        mostrarTabla();
      }else{alert('Contrase√±a incorrecta')}
    }
    function mostrarCambioPass(){
      const div=document.getElementById('passDiv');
      div.style.display= div.style.display==='none'?'block':'none';
      mostrarForm(null);
    }
    function cambiarPass(){
      const actual=document.getElementById('passActual').value;
      const nueva1=document.getElementById('passNueva1').value;
      const nueva2=document.getElementById('passNueva2').value;
      if(actual!==PASS){alert('Contrase√±a actual incorrecta');return}
      if(!nueva1 || nueva1!==nueva2){alert('Las nuevas contrase√±as no coinciden o est√°n vac√≠as');return}
      PASS=nueva1;
      localStorage.setItem('bodegaPass',PASS);
      alert('Contrase√±a actualizada');
      mostrarCambioPass(null);
    }

    let editando=false;
    function mostrarForm(modo,id){
      const form=document.getElementById('formDiv');
      form.style.display=modo?'block':'none';
      if(!modo) return;
      if(modo==='add'){
        editando=false;
        ['fId','fNombre','fPrecio','fUrl'].forEach(id=>document.getElementById(id).value='');
        document.getElementById('fCat').value='vinos';
        document.getElementById('fDisp').value='true';
        document.getElementById('fImg').src='';
        document.getElementById('fFile').value='';
      }else{
        editando=true;
        const p=catalogo.find(x=>x.id===id);
        document.getElementById('fId').value=p.id;
        document.getElementById('fNombre').value=p.nombre;
        document.getElementById('fPrecio').value=p.precio;
        document.getElementById('fCat').value=p.categoria;
        document.getElementById('fDisp').value=p.disponible;
        document.getElementById('fImg').src=p.img;
        document.getElementById('fUrl').value=p.img;
      }
    }
    document.getElementById('fFile').addEventListener('change',function(e){
      const file=e.target.files[0];
      if(!file)return;
      const reader=new FileReader();
      reader.onload=function(ev){
        document.getElementById('fImg').src=ev.target.result;
      };
      reader.readAsDataURL(file);
    });
    document.getElementById('fUrl').addEventListener('input',function(){
      const url=this.value.trim();
      if(url) document.getElementById('fImg').src=url;
    });
    function guardar(){
      const id=editando?Number(document.getElementById('fId').value):Date.now();
      const nombre=document.getElementById('fNombre').value.trim();
      const precio=Number(document.getElementById('fPrecio').value);
      const categoria=document.getElementById('fCat').value;
      const disponible=document.getElementById('fDisp').value==='true';
      let img='';
      const urlInput=document.getElementById('fUrl').value.trim();
      const fileInput=document.getElementById('fFile').files[0];
      if(urlInput){
        img=urlInput;
        saveProduct(id,nombre,precio,categoria,disponible,img);
      }else if(fileInput){
        const reader=new FileReader();
        reader.onload=function(ev){
          img=ev.target.result;
          saveProduct(id,nombre,precio,categoria,disponible,img);
        };
        reader.readAsDataURL(fileInput);
        return;
      }else{
        img='https://images.unsplash.com/photo-1520732483780-842b8ec93380?auto=format&fit=crop&w=600&q=60';
        saveProduct(id,nombre,precio,categoria,disponible,img);
      }
    }
    function saveProduct(id,nombre,precio,categoria,disponible,img){
      if(!nombre || !precio){alert('Faltan datos (nombre y precio obligatorios)');return}
      if(editando){
        const idx=catalogo.findIndex(x=>x.id===id);
        catalogo[idx]={id,nombre,precio,categoria,disponible,img};
      }else{
        catalogo.push({id,nombre,precio,categoria,disponible,img});
      }
      localStorage.setItem('bodegaCatalogo',JSON.stringify(catalogo));
      mostrarForm(null);
      mostrarTabla();
      renderizar();
    }
    function borrar(id){
      if(!confirm('¬øBorrar?'))return;
      catalogo=catalogo.filter(x=>x.id!==id);
      localStorage.setItem('bodegaCatalogo',JSON.stringify(catalogo));
      mostrarTabla();
      renderizar();
    }
    function mostrarTabla(){
      const tbody=document.getElementById('listaProd');
      tbody.innerHTML='';
      catalogo.forEach(p=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`
          <td><img class="mini" src="${p.img}"></td>
          <td>${p.nombre}</td>
          <td>${p.precio} CUP</td>
          <td>${p.categoria}</td>
          <td>${p.disponible?'Disp':'Agot'}</td>
          <td>
            <button onclick="mostrarForm('edit',${p.id})">Editar</button>
            <button onclick="borrar(${p.id})">Borrar</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    /* ----------  CARRITO  ---------- */
    let carrito=[];
    const carritoCant=document.getElementById('carritoCant');
    const carritoIcon=document.getElementById('carritoIcon');

    function addCarrito(id){
      const prod=catalogo.find(p=>p.id===id);
      if(!prod || !prod.disponible)return;
      const linea=carrito.find(l=>l.id===id);
      if(linea){
        linea.cant++;
      }else{
        carrito.push({...prod,cant:1});
      }
      actualizarCarritoUI();
      mostrarCarrito();
    }
    function actualizarCarritoUI(){
      const total=carrito.reduce((t,l)=>t+l.cant,0);
      carritoCant.textContent=total;
      carritoIcon.textContent=total>0?'üõí':'üõí';
    }
    function mostrarCarrito(){
      const lista=document.getElementById('listaCarrito');
      const total=document.getElementById('totalCarrito');
      lista.innerHTML='';
      if(carrito.length===0){
        lista.innerHTML='<p style="color:#666">No hay productos en el carrito</p>';
        total.textContent='0 CUP';
      }else{
        let suma=0;
        carrito.forEach(l=>{
          const div=document.createElement('div');
          div.className='itemCarrito';
          div.innerHTML=`
            <div>
              <strong>${l.nombre}</strong><br>
              <small>${l.cant} √ó ${l.precio} CUP</small>
            </div>
            <div>
              <button onclick="modCant(${l.id},-1)">‚àí</button>
              <span>${l.cant}</span>
              <button onclick="modCant(${l.id},1)">+</button>
            </div>
          `;
          lista.appendChild(div);
          suma+=l.cant*l.precio;
        });
        total.textContent=suma.toLocaleString()+' CUP';
      }
      document.getElementById('modalFondo').style.display='flex';
    }
    function modCant(id,cambio){
      const linea=carrito.find(l=>l.id===id);
      if(!linea)return;
      linea.cant+=cambio;
      if(linea.cant<=0) carrito=carrito.filter(l=>l.id!==id);
      actualizarCarritoUI();
      mostrarCarrito();
    }
    function cerrarCarrito(e){
      if(!e || e.target.id==='modalFondo') document.getElementById('modalFondo').style.display='none';
    }
    function enviarWhatsApp(){
      if(carrito.length===0){alert('Carrito vac√≠o');return;}
      const tlf='5353941233'; /*5353072454*/
      let texto='Hola, quisiera hacer este pedido:%0A%0A';
      let total=0;
      carrito.forEach(l=>{
        texto+=`‚Ä¢ ${l.nombre} (${l.cant}√ó${l.precio} CUP)%0A`;
        total+=l.cant*l.precio;
      });
      texto+=`%0A*Total: ${total.toLocaleString()} CUP*%0A%0A¬øEst√° disponible?`;
      window.open(`https://wa.me/${tlf}?text=${texto}`,'_blank');
    }

    /* ----------  RENDER TIENDA  ---------- */
    const cont=document.getElementById('productos');
    function renderizar(lista=catalogo){
      cont.innerHTML='';
      lista.forEach(p=>{
        const tarjeta=document.createElement('div');
        tarjeta.className='tarjeta';
        tarjeta.innerHTML=`
          <img src="${p.img}" alt="${p.nombre}">
          <div class="info">
            <h3>${p.nombre}</h3>
            <span class="${p.disponible?'disponible':'agotado'}">${p.disponible?'Disponible':'Agotado'}</span>
            <div class="precio">${p.precio.toLocaleString()} CUP</div>
            <button onclick="addCarrito(${p.id})" style="margin-top:.5rem;padding:.4rem .8rem;border:none;border-radius:8px;background:var(--oro);color:#fff;font-weight:bold;cursor:pointer">Agregar</button>
          </div>
        `;
        cont.appendChild(tarjeta);
      });
    }
    function filtrar(cat){
      document.querySelectorAll('.btn-filtro').forEach(b=>b.classList.remove('activo'));
      event.target.classList.add('activo');
      renderizar(cat==='todos'?catalogo:catalogo.filter(x=>x.categoria===cat));
    }
    renderizar();
  </script>
</body>

</html>
